---
"ignore malformed":
  - do:
      indices.create:
        index: my-index2
        body:
          settings:
            index:
              mode: logsdb
              mapping.source.mode: stored
          mappings:
            properties:
              "@timestamp":
                type: date
              host.name:
                type: keyword
                store: false
              message:
                type: text
                store: false
              process_id:
                type: integer
                doc_values: false

  - do:
      bulk:
        index: my-index2
        refresh: true
        body:
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:30:00Z", "host.name": "foo", "message": "No, I am your father.", "process_id": "q101" }
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:31:00Z", "host.name": "bar", "message": "Do. Or do not. There is no try.", "process_id": "q102" }
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:32:00Z", "host.name": "foo", "message": "May the force be with you.", "process_id": "q103" }
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:33:00Z", "host.name": "baz", "message": "I find your lack of faith disturbing.", "process_id": "q102" }
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:34:00Z", "host.name": "baz", "message": "Wars not make one great.", "process_id": "q104" }
          - { "index": { } }
          - { "@timestamp": "2024-02-12T10:35:00Z", "host.name": "foo", "message": "That's no moon. It's a space station.", "process_id": "q105" }

  - do:
      esql.query:
        body:
          query: 'FROM my-index2 | SORT host.name, @timestamp | LIMIT 1'

  - match: {columns.0.name: "@timestamp"}
  - match: {columns.0.type: "date"}
  - match: {columns.1.name: "host.name"}
  - match: {columns.1.type: "keyword"}
  - match: {columns.2.name: "message"}
  - match: {columns.2.type: "text"}
  - match: {columns.3.name: "process_id"}
  - match: {columns.3.type: "integer"}

  - match: {values.0.0: "2024-02-12T10:31:00.000Z"}
  - match: {values.0.1: "bar"}
  - match: {values.0.2: "Do. Or do not. There is no try."}
  - match: {values.0.3: "q102"}

  - do:
      esql.query:
        body:
          query: 'FROM my-index2 | SORT host.name, @timestamp | KEEP process_id | LIMIT 10'

  - match: {columns.0.name: "process_id"}
  - match: {columns.0.type: "integer"}

  - match: {values.0.0: "q101"}
  - match: {values.1.0: "q102"}
  - match: {values.2.0: "q103"}
  - match: {values.3.0: "q102"}
  - match: {values.4.0: "q104"}
  - match: {values.5.0: "q105"}
