pr: 113735
summary: "ESQL: Introduce per agg filter"
area: ES|QL
type: feature
issues: []
highlight:
  title: "ESQL: Introduce per agg filter"
  body: "Add support for aggregation scoped filters that work dynamically on the \n\
    data in each group.\n\n```\n| STATS\n    success = COUNT(*) WHERE 200 <= code\
    \ AND code < 300,\n   redirect = COUNT(*) WHERE 300 <= code AND code < 400,\n\
    \ client_err = COUNT(*) WHERE 400 <= code AND code < 500,\n server_err = COUNT(*)\
    \ WHERE 500 <= code AND code < 600,\ntotal_count = COUNT(*)\n```\n\nImplementation\
    \ wise, the base AggregateFunction has been extended to \nallow a filter to be\
    \ passed on. This is required to incorporate the \nfilter as part of the aggregate\
    \ equality/identity which would fail with \nthe filter as an external component.\n\
    \nAs part of the process, the serialization for the existing aggregations \nhad\
    \ to be fixed so AggregateFunction implementations so that it \ndelegates to their\
    \ parent first."
  notable: true
